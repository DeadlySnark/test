;オプション設定処理
@OPTION
PRINTL 設定項目を選択してください
PRINTL [0] - テキスト設定
PRINTL [1] - コマンドフィルタ
PRINT [2] - 消耗品の自動購入 
	PRINTFORML \@ FLAG:1001 ? ON # OFF \@
PRINT [3] - 館の情報表示 
	PRINTFORML \@ FLAG:1002 ? OFF # ON \@
PRINTFORML [10] - 寝取られパッチオプション
PRINTFORML [11] - ぅなパッチオプション
PRINTL [100]-戻る
$INPUT_LOOP
INPUT
IF RESULT == 0
	CALL OPTION_TEXT_SETTING
ELSEIF RESULT == 1
	CALL OPTION_COMMAND_FILTER
ELSEIF RESULT == 2
	FLAG:1001 = !FLAG:1001
ELSEIF RESULT == 3
	CALL OPTION_HOUSE_INFO
ELSEIF RESULT == 10
	CALL NTR_OPTION
ELSEIF RESULT == 11
	CALL LUNA_OPTION
ELSEIF RESULT == 100
	RETURN 0
ELSE
	GOTO INPUT_LOOP
ENDIF
RESTART
;テキスト関連
@OPTION_TEXT_SETTING
PRINTL テキストの設定をしてください
PRINT 現在の設定：
IF FLAG:情景テキスト設定 == 1 && FLAG:口上テキスト設定 == 2
	PRINTL 【口上テキスト（常に表示）＋情景テキスト】
ELSEIF FLAG:情景テキスト設定 == 1 && FLAG:口上テキスト設定 == -1
	PRINTL 【情景テキストのみ】
ELSEIF FLAG:情景テキスト設定 == 0 && FLAG:口上テキスト設定 == -1
	PRINTL 【テキストを表示しない】
ENDIF
PRINTL 　
PRINTL [0] - 口上テキスト＋情景テキスト
PRINTL [1] - 情景テキストのみ
PRINTL [2] - テキストを表示しない
PRINTL [100]-戻る
$INPUT_LOOP
INPUT
IF RESULT == 100
	RETURN 0
ELSEIF RESULT == 0
	PRINTL 【口上テキスト＋情景テキスト】に設定しました
	FLAG:情景テキスト設定 = 1
	FLAG:口上テキスト設定 = 2
ELSEIF RESULT == 1
	PRINTL 【情景テキストのみ】に設定しました
	FLAG:情景テキスト設定 = 1
	FLAG:口上テキスト設定 = -1
ELSEIF RESULT == 2
	PRINTL 【テキストを表示しない】に設定しました
	FLAG:情景テキスト設定 = 0
	FLAG:口上テキスト設定 = -1
ELSE
	GOTO INPUT_LOOP
ENDIF

;文字列変数に保存してみた
@OPTION_COMMAND_FILTER
VARSET LOCAL
FOR COUNT,0,650
	LOCALS = /{COUNT}/
	SIF STRCOUNT(SAVESTR:0,LOCALS)
		LOCAL:COUNT = 1
NEXT
SIF SAVESTR:0 == ""
	SAVESTR:0 = /
DRAWLINE
TFLAG:100 = 1
FOR COUNT,0,650
	LOCALS = /{COUNT}/
	SIF STRCOUNT(SAVESTR:0,LOCALS)
		SETCOLOR 150,150,150
	SIF STRLENS(TRAINNAME:COUNT)
		PRINTFORMC %TRAINNAME:COUNT%[{COUNT,3}]
	RESETCOLOR
NEXT
TFLAG:100 = 0
PRINTL 
DRAWLINE
PRINTL [1000] - 決定 [1001] - リセット
PRINTL [1002] - コマンドフィルタの保存 [1003] - コマンドフィルタのロード
PRINTL [1010] - SMフィルタ [1011] - Ｖフィルタ
INPUT
IF RESULT == 1000
	RETURN 0
ELSEIF RESULT == 1001
	SAVESTR:0 = 
	RESTART
ELSEIF RESULT == 1002
	$INPUT_LOOP_SAVE
	LOADGLOBAL
	FOR LOCAL,0,3
		PRINTFORM [{LOCAL}] - 
		IF STRLENS(GLOBALS:(LOCAL * 2 + 1))
			PRINTFORML [%GLOBALS:(LOCAL * 2 + 1)%]
		ELSE
			PRINTL ----------
		ENDIF
	NEXT
	PRINTL [100] - 戻る
	INPUT
	LOCAL = RESULT
	IF RESULT == 100
		RESTART
	ELSEIF RESULT < 0 || RESULT > 2
		GOTO INPUT_LOOP_SAVE
	ENDIF
	SIF STRLENS(GLOBALS:(RESULT * 2 + 1))
		PRINTFORML 【%GLOBALS:(RESULT * 2 + 1)%】 このデータに上書きします
	PRINTL コマンドフィルタの名前を登録してください
	INPUTS
	GLOBALS:(LOCAL * 2 + 1) = %RESULTS%
	GLOBALS:(LOCAL * 2) = %SAVESTR:0%
	PRINTFORMW コマンドフィルタ【%GLOBALS:(LOCAL * 2 + 1)%】を登録しました
	SAVEGLOBAL
	RESTART
ELSEIF RESULT == 1003
	$INPUT_LOOP_LOAD
	LOADGLOBAL
	FOR LOCAL,0,3
		PRINTFORM [{LOCAL}] - 
		IF STRLENS(GLOBALS:(LOCAL * 2 + 1))
			PRINTFORML [%GLOBALS:(LOCAL * 2 + 1)%]
		ELSE
			PRINTL ----------
		ENDIF
	NEXT
	PRINTL [100] - 戻る
	INPUT
	IF RESULT == 100
		RESTART
	ELSEIF RESULT < 0 || RESULT > 2
		GOTO INPUT_LOOP_LOAD
	ENDIF
	PRINTFORMW コマンドフィルタ【%GLOBALS:(RESULT * 2 + 1)%】を読み込みました
	SAVESTR:0 = %GLOBALS:(RESULT * 2)%
	RESTART
;各種フィルタ
ELSEIF RESULT == 1010 || RESULT == 1011
	FOR COUNT,0,650
		;SM
		IF RESULT == 1010
			SIF (COUNT >= 100 && COUNT < 120) || (COUNT >= 140 && COUNT < 160)
				LOCAL:COUNT = 1
		;V
		ELSEIF RESULT == 1011
			SIF COUNT == 3 || COUNT == 44 || COUNT == 60 || COUNT == 61 || COUNT == 65 || COUNT == 67 || COUNT == 68 || COUNT == 71 
				LOCAL:COUNT = 1
			SIF COUNT == 122|| COUNT == 141 || COUNT == 143 || COUNT == 185 || COUNT == 603 || COUNT == 644
				LOCAL:COUNT = 1
		ENDIF
	NEXT
ELSEIF STRLENS(TRAINNAME:RESULT)
	LOCAL:RESULT = !LOCAL:RESULT
ELSE
	RESTART
ENDIF
SAVESTR:0 = /
FOR COUNT,0,650
	SIF !LOCAL:COUNT
		CONTINUE
	LOCALS = /{COUNT}/
	SIF !STRCOUNT(SAVESTR:0,LOCALS)
		SAVESTR:0 = %SAVESTR:0%{COUNT}/
NEXT
RESTART

@OPTION_HOUSE_INFO
PRINTL ゴミの山を見なかった事にできます
PRINTL [0] 情報表示ON [1] - OFF
INPUT
IF RESULT == 0
	FLAG:1002 = 0
ELSE
	FLAG:1002 = 1
ENDIF
