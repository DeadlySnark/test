;-------------------------------------------------------------------------------
;Ⓒn̏Ȃ
;-------------------------------------------------
;Ⓒ
;-------------------------------------------------
@ORGASM_ADD(z,=0)
	#DIM z
	#DIM 
	#DIM ⒸvW
	VARSET LOCAL
	LOCAL = ((CUP:z:b + PALAM:z:b) >= PALAMLV:4) + (CUP:z:u + PALAM:z:u >= PALAMLV:4) + (CUP:z:` + PALAM:z:` >= PALAMLV:4) + (CUP:z:a + PALAM:z:a >= PALAMLV:4)
	SELECTCASE LOCAL
		CASE 4
			LOCAL:1 = 7000
		CASE  3
			LOCAL:1 = 5000
		CASE 2
			LOCAL:1 = 3000
		CASE 1
			LOCAL:1 = 2000
	ENDSELECT
	;F̖ŎcĂ
	C = 0
	V = 0
	A = 0
	B = 0
	
	;K҈ȊO̒ŁAyCỹxꍇAⒸÂ炭Ȃ
	IF  != 998 && MARK:z:y < MARK:z:Cy
		ⒸvW = MAX( 100 * MARK:z:Cy / MAX(1,MARK:z:y) , 100 )
	ELSE
		ⒸvW = 100
	ENDIF
	
	;-------------------------------------------------------------------
	;Ⓒb
	LOCAL:2 = (CUP:z:b > 0) * LOCAL:1
	IF CUP:z:b + PALAM:z:b + LOCAL:2 >= PALAMLV:4 * 2 * ⒸvW / 100
		C = 2
		CDOWN:z:b = PALAMLV:4 * 2 - LOCAL:2
	ELSEIF CUP:z:b + PALAM:z:b + LOCAL:2 >= PALAMLV:4 * ⒸvW / 100
		C = 1
		CDOWN:z:b = PALAMLV:4 - LOCAL:2
	ELSEIF CUP:z:b + PALAM:z:b + LOCAL:2 >= PALAMLV:4
		;C͂Ȃ̂ɃCȂꍇ
		NOWEX:z:ⒸZ++
	ENDIF
	;DOWN:0ŉĂⒸȏȂ
	;̒l-1ɂȂ悤ɒi10000ŐⒸȂ9999j
	SIF CUP:z:b + PALAM:z:b - CDOWN:z:b >= PALAMLV:4
		CDOWN:z:b = CUP:z:b + PALAM:z:b - PALAMLV:4 + 1
	;-------------------------------------------------------------------
	;Ⓒu
	LOCAL:2 = (CUP:z:u > 0) * LOCAL:1
	IF CUP:z:u + PALAM:z:u + LOCAL:2 >= PALAMLV:4 * 2 * ⒸvW / 100
		V = 2
		CDOWN:z:u = PALAMLV:4 * 2 - LOCAL:2
	ELSEIF CUP:z:u + PALAM:z:u + LOCAL:2 >= PALAMLV:4 * ⒸvW / 100
		V = 1
		CDOWN:z:u = PALAMLV:4 - LOCAL:2
	ELSEIF CUP:z:u + PALAM:z:u + LOCAL:2 >= PALAMLV:4
		;C͂Ȃ̂ɃCȂꍇ
		NOWEX:z:ⒸZ++
	ENDIF
	;CDOWN:z:1ŉĂⒸȏȂ
	;̒l-1ɂȂ悤ɒi10000ŐⒸȂ9999j
	SIF CUP:z:u + PALAM:z:u - CDOWN:z:u >= PALAMLV:4
		CDOWN:z:u = CUP:z:u + PALAM:z:u - PALAMLV:4 + 1
	;-------------------------------------------------------------------
	;Ⓒ`
	LOCAL:2 = (CUP:z:` > 0) * LOCAL:1
	IF CUP:z:` + PALAM:z:` + LOCAL:2 >= PALAMLV:4 * 2 * ⒸvW / 100
		A = 2
		CDOWN:z:` = PALAMLV:4 * 2 - LOCAL:2
	ELSEIF CUP:z:` + PALAM:z:` + LOCAL:2 >= PALAMLV:4 * ⒸvW / 100
		A = 1
		CDOWN:z:` = PALAMLV:4 - LOCAL:2
	ELSEIF CUP:z:` + PALAM:z:` + LOCAL:2 >= PALAMLV:4
		;C͂Ȃ̂ɃCȂꍇ
		NOWEX:z:ⒸZ++
	ENDIF
	;CDOWN:z:`ŉĂⒸȏȂ
	;̒l-1ɂȂ悤ɒi10000ŐⒸȂ9999j
	SIF CUP:z:` + PALAM:z:` - CDOWN:z:` >= PALAMLV:4
		CDOWN:z:` = CUP:z:` + PALAM:z:` - PALAMLV:4 + 1
	;-------------------------------------------------------------------
	;Ⓒa
	LOCAL:2 = (CUP:z:a > 0) * LOCAL:1
	IF CUP:z:a + PALAM:z:a + LOCAL:2 >= PALAMLV:4 * 2 * ⒸvW / 100
		B = 2
		CDOWN:z:a = (PALAMLV:4 * 2 - 1000) - LOCAL:2
	ELSEIF CUP:z:a + PALAM:z:a + LOCAL:2 >= PALAMLV:4 * ⒸvW / 100
		B = 1
		CDOWN:z:a = (PALAMLV:4 - 1000) - LOCAL:2
	ELSEIF CUP:z:a + PALAM:z:a + LOCAL:2 >= PALAMLV:4
		;C͂Ȃ̂ɃCȂꍇ
		NOWEX:z:ⒸZ++
	ENDIF
	;CDOWN:z:aŉĂⒸȏȂ
	;̒l-1ɂȂ悤ɒi10000ŐⒸȂ9999j
	SIF CUP:z:a + PALAM:z:a - CDOWN:z:a >= PALAMLV:4
		CDOWN:z:a = CUP:z:a + PALAM:z:a - PALAMLV:4 + 1
	;-------------------------------------------------
	;Ⓒ̒ǉ
	;-------------------------------------------------
	;y̏
	;Ⓒ̕ʂƋx̍vȏō擾
	R = C + V * 2 + A * 2 + B
	;R4ȏŉyRɑ
	IF R >= 3 && MARK:z:y < 3
		TCVAR:z:yx = 3
		;R3ȏŉyQɑ
	ELSEIF R >= 2 && MARK:z:y < 2
		TCVAR:z:yx = 2
		;R2ȏŉyPɑ
	ELSEIF R >= 1 && MARK:z:y < 1
		TCVAR:z:yx = 1
	ELSE
		TCVAR:z:yx = 0
	ENDIF
	IF C && V && A && B
		C *= 8
		V *= 8
		A *= 8
		B *= 8
		NOWEX:z:6 = 1
	ELSEIF C && V && A
		C *= 4
		V *= 4
		A *= 4
		NOWEX:z:5 = 1
	ELSEIF B && V && A
		B *= 4
		V *= 4
		A *= 4
		NOWEX:z:5 = 2
	ELSEIF C && B && A
		C *= 4
		B *= 4
		A *= 4
		NOWEX:z:5 = 3
	ELSEIF C && V && B
		C *= 4
		V *= 4
		B *= 4
		NOWEX:z:5 = 4
	ELSEIF C && V
		C *= 2
		V *= 2
		NOWEX:z:4 = 1
	ELSEIF C && A
		C *= 2
		A *= 2
		NOWEX:z:4 = 2
	ELSEIF V && A
		V *= 2
		A *= 2
		NOWEX:z:4 = 3
	ELSEIF C && B
		C *= 2
		B *= 2
		NOWEX:z:4 = 4
	ELSEIF V && B
		V *= 2
		B *= 2
		NOWEX:z:4 = 5
	ELSEIF A && B
		A *= 2
		B *= 2
		NOWEX:z:4 = 6
	ENDIF
	IF C
		SOURCE:z:Io += 500 * C
		SOURCE:z:] += 200 * C
		SOURCE:z: += 150 * C
		DOWNBASE:z:̗ += 20
		DOWNBASE:z:C += 10
	ENDIF
	IF V
		SOURCE:z:~ += 800 * V
		SOURCE:z: += 500 * V
		SOURCE:z:Io += 700 * V
		SOURCE:z:] += 400 * V
		SOURCE:z: += 300 * V
		DOWNBASE:z:̗ += 40
		DOWNBASE:z:C += 20
	ENDIF
	IF A
		SOURCE:z:~ += 500 * A
		SOURCE:z: += 700 * A
		SOURCE:z:Io += 900 * A
		SOURCE:z:] += 500 * A
		SOURCE:z: += 400 * A
		DOWNBASE:z:̗ += 60
		DOWNBASE:z:C += 30
	ENDIF
	IF B
		SOURCE:z:Io += 500 * B
		SOURCE:z:] += 200 * B
		SOURCE:z: += 150 * B
		DOWNBASE:z:̗ += 20
		DOWNBASE:z:C += 10
	ENDIF
	;NOWEXɃf[^iⒸɎgj
	NOWEX:z:0 = C
	NOWEX:z:1 = V
	NOWEX:z:2 = A
	NOWEX:z:3 = B
	;Ⓒ񐔂𑝂₷
	EX:z:0 += C
	EX:z:1 += V
	EX:z:2 += A
	EX:z:3 += B
	;Ⓒo𑝂₷
	EXP:z:Ⓒo += C + V + A + B
	EXP:z:bⒸo += C
	EXP:z:uⒸo += V
	EXP:z:`Ⓒo += A
	EXP:z:aⒸo += B
	;rfI
	IF TEQUIP:z:rfIBe
		IF NOWEX:z:6
			LOCALS = O2/O3/O4/
			TSTR:1 += LOCALS
		ENDIF
		IF NOWEX:z:5
			LOCALS = O2/O3/
			TSTR:1 += LOCALS
		ENDIF
		IF NOWEX:z:4
			LOCALS = O2/
			TSTR:1 += LOCALS
		ENDIF
		IF NOWEX:z:0 == 2
			LOCALS = C/C/
			TSTR:1 += LOCALS
		ELSEIF NOWEX:z:0 == 1
			LOCALS = C/
			TSTR:1 += LOCALS
		ENDIF
		IF NOWEX:z:1 == 2
			LOCALS = V/V/
			TSTR:1 += LOCALS
		ELSEIF NOWEX:z:1 == 1
			LOCALS = V/
			TSTR:1 += LOCALS
		ENDIF
		IF NOWEX:z:2 == 2
			LOCALS = A/A/
			TSTR:1 += LOCALS
		ELSEIF NOWEX:z:2 == 1
			LOCALS = A/
			TSTR:1 += LOCALS
		ENDIF
		IF NOWEX:z:3 == 2
			LOCALS = B/B/
			TSTR:1 += LOCALS
		ELSEIF NOWEX:z:3 == 1
			LOCALS = B/
			TSTR:1 += LOCALS
		ENDIF
	ENDIF
RETURN 1

;-------------------------------------------------------------------------------
;FIXME:֐̐Ă
;@return 1:xxx,0:xxx
@MESSAGE_PALAMCNG_B2
	IF NOWEX:6
		IF !GETBIT(CFLAG:3,2)
			EXP:ُo ++
			SETBIT CFLAG:ُo,2
		ENDIF
		PRINTL l d  
		PRINTL (ꂼ8{̎삪܂)
	ELSEIF NOWEX:5
		SELECTCASE NOWEX:5
			CASE 1
				PRINTL bu`Ⓒ
				PRINTL (ꂼ4{̎삪܂)
			CASE 2
				PRINTL au`Ⓒ
				PRINTL (ꂼ4{̎삪܂)
			CASE 3
				PRINTL ba`Ⓒ
				PRINTL (ꂼ4{̎삪܂)
			CASE 4
				PRINTL buaⒸ
				PRINTL (ꂼ4{̎삪܂)
		ENDSELECT
	ELSEIF NOWEX:4
		SELECTCASE NOWEX:4
			CASE 1
				PRINTL buⒸ
				PRINTL (ꂼ2{̎삪܂)
			CASE 2
				PRINTL b`Ⓒ
				PRINTL (ꂼ2{̎삪܂)
			CASE 3
				PRINTL u`Ⓒ
				PRINTL (ꂼ2{̎삪܂)
			CASE 4
				PRINTL baⒸ
				PRINTL (ꂼ2{̎삪܂)
			CASE 5
				PRINTL uaⒸ
				PRINTL (ꂼ2{̎삪܂)
			CASE 6
				PRINTL `aⒸ
				PRINTL (ꂼ2{̎삪܂)
		ENDSELECT
	ELSEIF NOWEX:3
		IF NOWEX:3 == 2
			PRINTL Ⓒa
		ELSE
			PRINTL Ⓒa
		ENDIF
	ELSEIF NOWEX:2
		IF NOWEX:2 == 2
			PRINTL Ⓒ`
		ELSE
			PRINTL Ⓒ`
		ENDIF
	ELSEIF NOWEX:1
		IF NOWEX:1 == 2
			PRINTL Ⓒu
		ELSE
			PRINTL Ⓒu
		ENDIF
	ELSEIF NOWEX:0
		IF NOWEX:0 == 2
			PRINTL Ⓒb
		ELSE
			PRINTL Ⓒb
		ENDIF
	ENDIF
	;Ⓒɂ~]kuAbv
	LOCAL = 0
	SIF NOWEX:0 >= 2 || NOWEX:3 >= 2 || NOWEX:1 || NOWEX:2
		LOCAL = 1
	SIF NOWEX:1 >= 2 || NOWEX:2 >= 2
		LOCAL = 2
	SIF (NOWEX:0 >= 2 || NOWEX:3 >= 2) && NOWEX:4
		LOCAL = 2
	SIF NOWEX:5
		LOCAL = 3
	SIF NOWEX:6
		LOCAL = 4
	;SƂP
	SIF TALENT:S
		LOCAL -= 1
	IF ABL:~] < LOCAL
		ABL:~] ++
		PRINTFORML ė~]LV{LOCAL}ɂȂ
		;~]̏㏸ɂ[}]̏ł`FbN
		CALL YOKUBO_UP_CHECK
	ENDIF
	PRINTL 

;-------------------------------------------------
;Ώۂ̕`FbN
;-------------------------------------------------
@TARGET_MILK_CHECK(z)
	#DIM z
	SIF !TALENT:z:̎
		RETURN 0
	LOCAL = CUP:z:b/5 + CUP:z:u/5 + CUP:z:`/5 + CUP:z:a*3
	;S
	SIF TALENT:z:S
		LOCAL /= 2
	;ɑf
	SIF TALENT:z: > 0
		TIMES LOCAL , 1.20
	;̔ےiAwŖj
	SIF TALENT:z: < 0 && !TALENT:z:
		TIMES LOCAL , 0.80
	;Bq
	SIF TALENT:z:ax > 0
		TIMES LOCAL , 1.20
	;Z
	SIF TEQUIP:z:Z
		LOCAL *= 2
	;A
	SIF TEQUIP:z:A
		LOCAL /= 2
	;҂cލs
	SIF TALENT:PLAYER:c^cލs
		TIMES LOCAL , 1.20
	;҂ct
	SIF TALENT:PLAYER:ct
		TIMES LOCAL , 1.20
	;n
	SIF TALENT:z:oXgTCY < 0
		TIMES LOCAL , 0.50
	BASE:z: += LOCAL/2
	IF  BASE:z: > MAXBASE:z: * 2
		;Q{܂Ă
		LOCAL = 1
	ELSEIF BASE:z: > MAXBASE:z:
		;^Ă
		LOCAL = 0
	ELSE
		RETURN 0
	ENDIF
	LOCAL ++
	DOWNBASE:z:̗ += 20 * LOCAL
	DOWNBASE:z:C += 100 * (LOCAL - 1)
	IF EXP:z:o < EXPLV:1
		SOURCE:z:Io += 5000 * LOCAL
		SOURCE:z:] += 2500 * LOCAL
		SOURCE:z:s += 1000 * LOCAL
	ELSEIF EXP:z:o < EXPLV:2
		SOURCE:z:Io += 2500 * LOCAL
		SOURCE:z:] += 1500 * LOCAL
		SOURCE:z:s += 750 * LOCAL
	ELSEIF EXP:z:o < EXPLV:3
		SOURCE:z:Io += 1500 * LOCAL
		SOURCE:z:] += 750 * LOCAL
		SOURCE:z:s += 500 * LOCAL
	ELSEIF EXP:z:o < EXPLV:4
		SOURCE:z:Io += 750 * LOCAL
		SOURCE:z:] += 400 * LOCAL
		SOURCE:z:s += 350 * LOCAL
	ELSEIF EXP:z:o < EXPLV:5
		SOURCE:z:Io += 500 * LOCAL
		SOURCE:z:] += 250 * LOCAL
		SOURCE:z:s += 200 * LOCAL
	ELSE
		SOURCE:z:Io += 250 * LOCAL
		SOURCE:z:] += 150 * LOCAL
	ENDIF
	PRINTFORML %CALLNAME:z%͓񂩂\@ LOCAL == 2 ? ʂ # \@𕬏o
	IF EXP:z:o == 0
		EXP:z:ُo ++
	ENDIF
	EXP:z:o += LOCAL
	;aɕ
	STAIN:z:a |= 16
	BASE:z: -= MAXBASE:z: * LOCAL
	SIF BASE:z: >= MAXBASE:z:
		BASE:z: = MAXBASE:z: - 1
	NOWEX:z:10 += LOCAL
	EX:z:10 += LOCAL
	;rfI
	IF TEQUIP:z:rfIBe
		IF NOWEX:z:10 == 1
			LOCALS = MILK/
		ELSEIF NOWEX:z:10 == 2
			LOCALS = MILK/MILK/
		ENDIF
		TSTR:1 += LOCALS
	ENDIF
