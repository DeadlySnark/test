;-------------------------------------------------
;自慰する→MASTERを襲う訪問者編
;-------------------------------------------------
@NTR_COM416

#DIM DYNAMIC FLAG_EXECUTE
#DIM DYNAMIC COUNT_DRESS

FLAG_EXECUTE = 0 ; ｛1→一人情事、2→大欲情、3→露出調教｝が原因
COUNT_DRESS  = 0

; 除外条件→訪問者と同じ場所ではない ＆ 屋敷外ではない ＆ 住人がいる
SIF FLAG:訪問者の現在位置 != CFLAG:MASTER:現在位置
	RETURN
SIF FLAG:訪問者の現在位置 == 900
	RETURN
SIF FLAG:訪問者の現在位置 == 901
	RETURN
SIF FLAG:訪問者の現在位置 == 950
	RETURN
SIF FLAG:訪問者の現在位置 == 951
	RETURN
SIF GET_N_IN_ROOM(FLAG:訪問者の現在位置, 0, 0, 1) != 0
	RETURN


; 実行確定条件
SIF CFLAG:MASTER:うふふ == 3
	FLAG_EXECUTE = 1 ; MASTERの一人情事
SIF FLAG:訪問者の現在位置 == 18
	FLAG_EXECUTE = 2 ; 大欲情なら仕方ない

SIF FLAG_EXECUTE
	DEBUGPRINTFORML あなたは襲われました。

IF !FLAG_EXECUTE
	; 着衣状況チェック
	COUNT_DRESS = DRESS_LEVEL(MASTER) & ( 1p1 | 1p2 | 1p3 | 1p4 )
	DEBUGPRINTFORML あなたの防御力：{COUNT_DRESS}　／　あなたの屈服度：{CFLAG:MASTER:屈服度}

	IF COUNT_DRESS == ( 1p1 | 1p2 | 1p3 | 1p4 )
		RETURN ; フル装備なら防御できる
	ELSEIF COUNT_DRESS == ( 1p1 | 1p3 | 1p4 ) || COUNT_DRESS == ( 1p2 | 1p3 | 1p4 )
		SIF CFLAG:MASTER:屈服度 < RAND:1000 || RAND:100 > 50
			RETURN
	ELSEIF COUNT_DRESS == ( 1p3 | 1p4 )
		SIF CFLAG:MASTER:屈服度 < RAND:1000
			RETURN
	ELSEIF COUNT_DRESS == ( 1p1 | 1p2 | 1p3 ) || COUNT_DRESS == ( 1p1 | 1p2 | 1p4 )
		SIF CFLAG:MASTER:屈服度 < RAND:1000 && RAND:100 > 50
			RETURN
	ELSEIF COUNT_DRESS == ( 1p1 | 1p2 )
		SIF CFLAG:MASTER:屈服度 < RAND:100 && RAND:100 > 50
			RETURN
	ELSEIF COUNT_DRESS == ( 1p1 ) || COUNT_DRESS == ( 1p2 )
		SIF CFLAG:MASTER:屈服度 < RAND:100 && RAND:100 > 95
			RETURN
	ELSE
		SIF 0
			RETURN
	ENDIF
	
	FLAG_EXECUTE = 3
ENDIF

IF FLAG_EXECUTE
	PRINTFORM %NTR_NAME(0)%は
	SELECTCASE FLAG_EXECUTE
	CASE 1
		PRINT 目の前で自慰を始めた
	CASE 2
		PRINT 一糸纏わぬ
	CASE 3
		IF COUNT_DRESS == 0
			PRINT 一糸纏わぬ
		ELSE
			PRINT 煽情的な姿の
		ENDIF
	ENDSELECT
	PRINTFORM %CALLNAME:MASTER%の姿に興奮し、
	SIF CFLAG:MASTER:屈服度 < 1000
		PRINTFORM \@ BASE:MASTER:気力 <= 0 ? 抵抗する気力が無くなった # 暴れる \@%CALLNAME:MASTER%を無理矢理
	
	IF BEDROOM(FLAG:訪問者の現在位置)
		PRINT ベッドに押し倒すと足を開き
	ELSEIF OPENPLACE(FLAG:訪問者の現在位置) == 2
		PRINT 目立たない茂みの中へ連れ込むと足を開き
	ELSE
		PRINT 壁に追いやり片足を持ち上げると
	ENDIF
	IF HAS_VAGINA(MASTER)
		IF TALENT:MASTER:処女
			PRINTFORMW 亀頭を浅く挿入してから、男を知らない\@ TALENT:MASTER:体型 < 0 ? 幼いワレメ # 秘裂 \@を貫いていった…
		ELSE
			PRINTFORMW \@ TALENT:MASTER:体型 < 0 ? 幼いワレメ # 秘裂 \@にペニスをあてがい貫いた…
		ENDIF
		LOCAL = RAND:20 + 10
		TIME += LOCAL
		PRINTFORMW 　　　　　　・
		PRINTFORMW 　　　　　　・
		PRINTFORMW 　　　　　　・
		IF TALENT:MASTER:処女
			PRINTFORML %CALLNAME:MASTER%の処女は%NTR_NAME(0)%によって散らされてしまった・・
			PRINTFORML ＜%CALLNAME:MASTER%は処女を失いました＞
		ENDIF
		PRINTFORML {LOCAL}分間%CALLNAME:MASTER%の膣内を味わった後、%NTR_NAME(0)%は子宮に精液を注ぎ込んだ
		PRINTFORML 溢れ出た精液\@ TALENT:MASTER:処女 ? と処女血 # \@は\@ BEDROOM(FLAG:訪問者の現在位置) ? シーツ # 地面 \@に零れ、染み込んでいった

		CFLAG:MASTER:屈服度 += (5 + RAND:5)
		BASE:MASTER:体力 = MAX(0,BASE:MASTER:体力 - 50)
		;屈服度が高い場合は抵抗しないので気力消費が少ない？
		BASE:MASTER:気力 = MAX(0,BASE:MASTER:気力-(150-LIMIT(0,70,CFLAG:MASTER:屈服度/10)))
		SOURCE:MASTER:快Ｖ = 400
		;SOURCE:MASTER:情愛 = 150
		;SOURCE:MASTER:苦痛 = 500
		;SOURCE:MASTER:露出 = 50
		;SOURCE:MASTER:反感 = 300
		;SIF TALENT:MASTER:自己愛 < 0 || TALENT:MASTER:抵抗
		;	SOURCE:MASTER:鬱屈 += 300
		;SIF TALENT:MASTER:貞操 > 0 && CFLAG:MASTER:屈服度 < 1000
		;	SOURCE:MASTER:反感 += 1000
		;IF TALENT:MASTER:処女 == 1
		;	SOURCE:MASTER:苦痛 += 2000
		;	SOURCE:MASTER:反感 += 3000
		;ELSEIF TALENT:MASTER:処女 == 2
		;	SOURCE:MASTER:苦痛 += 500
		;	SOURCE:MASTER:反感 += 1000
		;ENDIF
		EXP:MASTER:精液経験 ++
		EXP:MASTER:Ｖ経験 ++
		EXP:MASTER:Ｖ性交経験 ++
		IF ABL:MASTER:Ｖ感覚 > RAND:5
			EXP:MASTER:Ｖ絶頂経験 ++
			EXP:MASTER:絶頂経験 ++
		ENDIF

		SETBIT FLAG:訪問者との汚れ判定に使用,0
		IF GETBIT(FLAG:訪問者との汚れ判定に使用,0)
			SETBIT STAIN:MASTER:Ｖ,0
			SETBIT STAIN:MASTER:膣内,0
		ENDIF
		SETBIT STAIN:MASTER:Ｖ,1
		SETBIT STAIN:MASTER:膣内,1
		SETBIT FLAG:訪問者との汚れ判定に使用,2
		SETBIT STAIN:MASTER:Ｖ,2
		SETBIT STAIN:MASTER:膣内,2
		IF GETBIT(FLAG:訪問者との汚れ判定に使用,3)
			SETBIT STAIN:MASTER:Ｖ,3
			SETBIT STAIN:MASTER:膣内,3
		ENDIF

		IF TALENT:MASTER:処女
			SETBIT STAIN:MASTER:Ｖ,6
			SETBIT STAIN:MASTER:膣内,6
			SETBIT FLAG:訪問者との汚れ判定に使用,6
			TALENT:MASTER:処女 = 0
			SETBIT FLAG:訪問者との汚れ判定に使用,2
			CFLAG:MASTER:屈服度 += (10 + RAND:10)
		ENDIF
		;V感覚が高いと絶頂経験加算（強絶頂扱い）
		;CALL NTR_V_EXP_PLUS(MASTER)
		TRYCALL 精力取得, 998
		TRYCALL NTR_SAMEN_EXP_PLUS(MASTER, 0)
		TRYCALL 精子取得, 998, MASTER
		CFLAG:MASTER:射精者 = 21
	ELSE
		PRINTFORMW アナルにペニスをあてがい貫いた…
		LOCAL = RAND:20 + 10
		TIME += LOCAL
		PRINTFORMW 　　　　　　・
		PRINTFORMW 　　　　　　・
		PRINTFORMW 　　　　　　・
		PRINTFORML {LOCAL}分間%CALLNAME:MASTER%のアナルを味わった後、%NTR_NAME(0)%は精液を注ぎ込んだ
		PRINTFORML 溢れ出た精液は\@ BEDROOM(FLAG:訪問者の現在位置) ? シーツ # 地面 \@に零れ、染み込んでいった

		CFLAG:MASTER:屈服度 += (5 + RAND:5)
		BASE:MASTER:体力 = MAX(0,BASE:MASTER:体力 - 50)
		;屈服度が高い場合は抵抗しないので気力消費が少ない？
		BASE:MASTER:気力 = MAX(0,BASE:MASTER:気力-(150-LIMIT(0,70,CFLAG:MASTER:屈服度/10)))
		SOURCE:MASTER:快Ａ = 400
		;SOURCE:MASTER:情愛 = 150
		;SOURCE:MASTER:苦痛 = 1000
		;SOURCE:MASTER:露出 = 50
		;SOURCE:MASTER:反感 = 300
		;SIF TALENT:MASTER:自己愛 < 0 || TALENT:MASTER:抵抗
		;	SOURCE:MASTER:鬱屈 += 300
		;SIF TALENT:MASTER:貞操 > 0 && CFLAG:MASTER:屈服度 < 1000
		;	SOURCE:MASTER:反感 += 1000
		EXP:MASTER:精液経験 ++
		EXP:MASTER:Ａ経験 ++
		EXP:MASTER:Ａ性交経験 ++
		IF ABL:MASTER:Ａ感覚 > RAND:5
			EXP:MASTER:Ａ絶頂経験 ++
			EXP:MASTER:絶頂経験 ++
		ENDIF

		SETBIT FLAG:訪問者との汚れ判定に使用,0
		IF GETBIT(FLAG:訪問者との汚れ判定に使用,0)
			SETBIT STAIN:MASTER:Ａ,0
			SETBIT STAIN:MASTER:腸内,0
		ENDIF
		SETBIT STAIN:MASTER:Ａ,1
		SETBIT STAIN:MASTER:腸内,1
		SETBIT FLAG:訪問者との汚れ判定に使用,2
		SETBIT STAIN:MASTER:Ａ,2
		SETBIT STAIN:MASTER:腸内,2
		IF GETBIT(FLAG:訪問者との汚れ判定に使用,3)
			SETBIT STAIN:MASTER:Ａ,3
			SETBIT STAIN:MASTER:腸内,3
		ENDIF

	ENDIF
	FLAG:MASTERが犯された回数 += 1
ENDIF



;-------------------------------------------------
; 服装の被覆レベルを返す / TEQUIPでは作れなかった状況なので。
; ARG→対象キャラ
; RETURN→例：[ & 20 == 0 で下半身まるみえ ] [ & 10 == 0 で上半身まるみえ ] [ & 24 == 0 で下着姿 ]
;-------------------------------------------------
@DRESS_LEVEL(ARG)
#FUNCTION
#DIM DYNAMIC LEVEL_DRESS

SIF EQUIP:MASTER:ボディースーツ || EQUIP:MASTER:ワンピース || EQUIP:MASTER:着物 || EQUIP:MASTER:レオタード
	LEVEL_DRESS |= 1p3 + 1p4
SIF EQUIP:MASTER:下半身上着１ || EQUIP:MASTER:下半身上着２ || EQUIP:MASTER:スカート
	LEVEL_DRESS |= 1p4
SIF EQUIP:MASTER:上半身上着１ || EQUIP:MASTER:上半身上着２
	LEVEL_DRESS |= 1p3
SIF EQUIP:MASTER:下半身下着１ || EQUIP:MASTER:下半身下着２
	LEVEL_DRESS |= 1p2
SIF EQUIP:MASTER:上半身下着１ || EQUIP:MASTER:上半身下着２
	LEVEL_DRESS |= 1p1
SIF EQUIP:MASTER:アクセサリ || EQUIP:MASTER:帽子 || EQUIP:MASTER:靴 || EQUIP:MASTER:靴下
	LEVEL_DRESS |= 1p0

RETURNF LEVEL_DRESS
